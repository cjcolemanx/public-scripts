# TODO: have less while loops + duplication
